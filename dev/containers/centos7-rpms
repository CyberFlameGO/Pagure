FROM centos:7

RUN yum -y install \
    epel-release \
    yum-utils \
    rpm-build \
    python-setuptools \
    python-coverage \
    python-nose \
    python2-mock \
    python-docutils \
    python-enum \
    python-flask \
    redis \
    which
ADD ./fedora-infra-tags.repo /etc/yum.repos.d/infra-tags.repo


RUN cd /pagure && \
    yum install -y `grep "Requires:" /pagure/files/pagure.spec | \
    awk '{split($0, a, " "); print a[2]}' |grep -v "%{name}" | \
    sed -e "s|%{python_pkgversion}||"` && \
    localedef -i en_US -f UTF-8 en_US.UTF-8

#RUN yum -y install python2-mock redis
#    yum clean all &&\

#ENV LC_ALL=C.UTF-8 LANG=C.UTF-8
WORKDIR /pagure
ENTRYPOINT ["python2", "/pagure/runtests.py", "run", "-f"]
#ENTRYPOINT ["py.test", "-x", "tests/"]
CMD []
